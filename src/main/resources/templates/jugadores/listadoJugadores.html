<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<!-- Bootstrap CSS -->
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
	integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
	crossorigin="anonymous">

<!--  Datatables  -->
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/v/bs4/dt-1.10.20/datatables.min.css" />

<!--  extension responsive  -->
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css">
<title>Listado de Jugadores</title>
<title>Jugadores</title>
</head>
<body class="bg-light">
	
	<script src="https://www.w3schools.com/lib/w3data.js"></script>
	
	<div class="">
	<div w3-include-html="navbar?id=listadoJugadores"></div> 
	</div>

	<div class="container-fluid">
		<div class="row">
			<div class="py-3 text-center col-lg-12">
				<h1 class="font-weight-bold font-italic">LISTA JUGADORES</h1>
			</div>
		</div>


		<div class="row">
			<div class="col-lg-12 responsive">
				<table id="jugadores"
					class="table table-sm table-striped table-bordered table-hover nowrap"
					cellspacing="0" style="width: 100%;">
					<thead>
						<tr class="table-primary">
							<th>Nombre</th>
							<th>Apellido</th>
							<th>dni</th>
							<th>Direccion</th>
							<th>Email</th>
							<th>Localidad</th>
							<th>Altura</th>
							<th>Peso</th>
							<th>Fecha Nacimiento</th>
							<th>Posición</th>
							<th>Posicion Secundaria</th>
							<th>Acciones</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="jugador : ${jugadores}">
							<td th:text="${jugador.firstName}"></td>
							<td th:text="${jugador.lastName}"></td>
							<td th:text="${jugador.dni}"></td>
							<td th:text="${jugador.direccion}"></td>
							<td th:text="${jugador.email}"></td>
							<td th:text="${jugador.localidad}"></td>
							<td th:text="${jugador.altura}"></td>
							<td th:text="${jugador.peso}"></td>
							<td th:text="${jugador.fechaNacimiento}"></td>
							<td th:text="${jugador.posicionPrincipal}"></td>
							<td th:text="${jugador.posicionSecundaria}"></td>
							<td>
								<input type="hidden" id="id" th:value="${jugador.id}"></input>
								<button class="btn btn-outline-success mx-0 estadisticas" type="button" title="Estadísticas"><svg width="1.5em" height=1.5em viewBox="0 0 16 16" class="bi bi-graph-up" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
									<path fill-rule="evenodd" d="M0 0h1v15h15v1H0V0zm10 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V4.9l-3.613 4.417a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61L13.445 4H10.5a.5.5 0 0 1-.5-.5z"/>
									</svg>
								</button>
								<button class="btn btn-outline-info mx-0 editar" type="button" title="Editar"><svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-pencil-square" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
									<path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456l-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
									<path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
									</svg>
								</button>
							</td>
					</tbody>

				</table>
			</div>
		</div>
	</div>

	<div class="row my-3">
		<div class="col-lg-2"></div>
		<div class="col-lg-8">
			<button onclick="location.href='/jugadores/jugadorform?id=0'"
				class="btn btn-primary btn-lg btn-block" type="submit">Añadir
				jugador</button>

		</div>
		<div class="col-lg-2"></div>
	</div>
	
	<!-- Modal Estadisticas -->
	<div class="modal fade" id="estadisticasModal" tabindex="-1" aria-labelledby="Estadísticas" aria-hidden="true">
	  <div class="modal-dialog modal-xl modal-dialog-centered">
	    <div class="modal-content">
	      <div class="modal-header bg-success">
	        <h5 class="modal-title" id="staticBackdropLabel"></h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body">
	      <div id="contenedor-modal"></div>
	      </div>
	      <div class="modal-footer" style="background: rgb(40,167,69); background: linear-gradient(0deg, rgba(40,167,69,1) 0%, rgba(255,255,255,1) 100%);">
	        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
	      </div>
	    </div>
	  </div>
	</div>
	
	<!-- Modal Edicion -->
	<div class="modal fade" id="editarModal" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="Editar" aria-hidden="true">
	  <div class="modal-dialog modal-xl modal-dialog-centered">
	    <div class="modal-content">
		    <form th:action="@{/jugadores/updatejugador}" method="post">
		      <div class="modal-header bg-info">
		        <h5 class="modal-title" id="staticBackdropLabel"></h5>
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          <span aria-hidden="true">&times;</span>
		        </button>
		      </div>
		      <div class="modal-body">
			  	<div id="contenedor-modal">
			  			<div class="row">
							<div class="form-group col">
								<label><span class="text-danger">(*) </span>Nombre:</label><input class="form-control" type="text" placeholder="Nombre" th:id="firstName" name="firstName" required></input>
							</div>
							<div class="form-group col">
								<label><span class="text-danger">(*) </span>Apellidos:</label><input class="form-control" type="text" placeholder="Apellidos" th:id="lastName" name="lastName" required></input>
							</div>
						</div>
						<div class="row">
							<div class="form-group col">
								<label><span class="text-danger">(*) </span>Altura(cm):</label><input class="form-control" type="number" placeholder="Altura" th:id="altura" name="altura" required></input>
							</div>
							<div class="form-group col">
								<label><span class="text-danger">(*) </span>Peso(kg):</label><input class="form-control" type="number" placeholder="Peso" th:id="peso" name="peso" min="1" max="300" required></input>
							</div>
							<div class="form-group col">
								<label>Estado:</label> 
								<select class="form-control" th:id="estadoActual" name="estadoActual">
									<option th:id="EN_FORMA" th:value="EN_FORMA">EN FORMA</option>
									<option th:id="LESIONADO" th:value="LESIONADO">LESIONADO</option>
								</select>
							</div>
						</div>
						<div class="row">
						<div class="form-group col">
							<label>Posición principal:</label> 
							<select class="form-control" th:id="posicionPrincipal" name="posicionPrincipal">
								<option th:id="'PUNTA'" th:value="PUNTA">PUNTA</option>
								<option th:id="'OPUESTO'" th:value="OPUESTO">OPUESTO</option>
								<option th:id="'COLOCADOR'" th:value="COLOCADOR">COLOCADOR</option>
								<option th:id="'CENTRAL'" th:value="CENTRAL">CENTRAL</option>
								<option th:id="'LIBERO'" th:value="LIBERO">LÍBERO</option>
							</select>
						</div>
						<div class="form-group col">
							<label>Posición secundaria:</label> 
							<select class="form-control" th:id="posicionSecundaria" name="posicionSecundaria">
								<option th:id="'PUNTA'" th:value="PUNTA">PUNTA</option>
								<option th:id="'OPUESTO'" th:value="OPUESTO">OPUESTO</option>
								<option th:id="'COLOCADOR'" th:value="COLOCADOR">COLOCADOR</option>
								<option th:id="'CENTRAL'" th:value="CENTRAL">CENTRAL</option>
								<option th:id="'LIBERO'" th:value="LIBERO">LÍBERO</option>
							</select>
						</div>
					</div>
			  	</div>
			  </div>
		      <div class="modal-footer" style="background: rgb(23,162,184); background: linear-gradient(0deg, rgba(23,162,184,0.75) 0%, rgba(255,255,255,1) 100%);">
		        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
		        <input type="submit" class="btn btn-info" value="Aceptar"></input>
		        <input type="hidden" th:id="id" name="id"></input>
		      </div>
	    	</form>
	    </div>
	  </div>
	</div>


	<script src=https://code.jquery.com/jquery-3.5.1.js></script>
	<!-- Optional JavaScript -->
	<script
		src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
		integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>

	<!--   Datatables-->
	<script type="text/javascript"
		src="https://cdn.datatables.net/v/bs4/dt-1.10.20/datatables.min.js"></script>

	<!-- extension responsive -->
	<script
		src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
	<!-- Highcharts JS -->    
	<script type="text/javascript"
        src="//code.highcharts.com/highcharts.js"></script>
		
	<script>
		$(document)
				.ready(
						function() {
							$('#jugadores')
									.DataTable(
											{
												responsive : true,
												columnDefs : [ {
													responsivePriority : 0,
													targets : 0
												}, {
													responsivePriority : 1,
													targets : -1
												}, {
													responsivePriority : 2,
													targets : 6
												}, {
													responsivePriority : 2,
													targets : 7
												}, {
													responsivePriority : 0,
													targets : 9
												} ],
												"language" : {
													"url" : "https:////cdn.datatables.net/plug-ins/1.10.21/i18n/Spanish.json"
												}
											});
							$('table .estadisticas').on('click', function(){
								var id = $(this).parent().find('#id').val();
																
								$.ajax({
									type: 'GET',
									url: '/jugadores/findestadisticasjugador/'+id,
									success: function(stats){
										var max = Math.max(stats.saquesTotales,stats.recepcionesTotales,stats.colocacionesTotales,stats.defensasTotales,stats.bloqueosTotales,stats.rematesTotales,stats.fintasTotales,stats.numAtaquesRapidosTotales);

										Highcharts.chart('contenedor-modal', {
											chart: {
								                type: 'column',
								            },
								            title: {
									            text: '',
									        },
								            xAxis: {
								                categories: [
								                    'Saque',
								                    'Recepción',
								                    'Colocación',
								                    'Defensa',
								                    'Bloqueo',
								                    'Remate',
								                    'Finta',
								                    'Ataque Rápido'
								                ],
								                crosshair: true
								            },
								            yAxis: [{ // Primary yAxis
									            labels: {
									                format: '{value}',
									                style: {
									                    color: Highcharts.getOptions().colors[1]
									                }
									            },
									            title: {
									                text: 'Estadísticas',
									                style: {
									                    color: Highcharts.getOptions().colors[1]
									                }
									            },
									            opposite: true
									        }, { // Secondary yAxis
									        	max: 100,
									        	min: 0,
									            title: {
									                text: 'Porcentaje',
									                style: {
									                    color: Highcharts.getOptions().colors[0]
									                }
									            },
									            labels: {
									                format: '{value} %',
									                style: {
									                    color: Highcharts.getOptions().colors[1]
									                }
									            }
									        }],
								            tooltip: {
								                headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
								                pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
								                    '<td style="padding:0"><b>{point.y:f} </b></td></tr>',
								                footerFormat: '</table>',
								                shared: true,
								                useHTML: true
								            },
								            plotOptions: {
								                column: {
								                    pointPadding: 0.2,
								                    borderWidth: 0
								                }
								            },
								            series: [
								                {
								                    name: 'Acertados',
								                    data: [stats.saquesAcertados,stats.recepcionesAcertadas,stats.colocacionesAcertadas,stats.defensasAcertadas,stats.bloqueosAcertados,stats.rematesAcertados,stats.fintasAcertadas,stats.numAtaquesRapidosAcertados]
								                },
								                {
								                    name: 'Totales',
								                    data: [stats.saquesTotales,stats.recepcionesTotales,stats.colocacionesTotales,stats.defensasTotales,stats.bloqueosTotales,stats.rematesTotales,stats.fintasTotales,stats.numAtaquesRapidosTotales],
								                },
								                {
								                    name: 'Porcentajes',
								                    data: [stats.porcentajeSaques*100,stats.porcentajeRecepciones*100,stats.porcentajeColocaciones*100,stats.porcentajeDefensas*100,stats.porcentajeBloqueos*100,stats.porcentajeRemates*100,stats.porcentajeFintas*100,stats.porcentajeAtaquesRapidos*100],
								                }
								            ]
										})
										$('.modal-header').css("color","white");
										$('.modal-title').text("Estadísticas de "+stats.firstName+" "+stats.lastName);
										$('#estadisticasModal').modal("show");
									}
								});
								
							});
							
							$('table .editar').on('click', function(){
								var id = $(this).parent().find('#id').val();
								
								$.ajax({
									type: 'GET',
									url: '/jugadores/findeditjugador/'+id,
									success: function(edit){
										$('#editarModal #id').val(edit.id);
										$('#editarModal #firstName').val(edit.firstName);
										$('#editarModal #lastName').val(edit.lastName);
										$('#editarModal #altura').val(edit.altura);
										$('#editarModal #peso').val(edit.peso);
										$('#editarModal #estadoActual').val(edit.estadoActual);
										$('#editarModal #estadoActual').val(edit.estadoActual);
										$('#editarModal #posicionPrincipal').val(edit.posicionPrincipal);
										$('#editarModal #posicionSecundaria').val(edit.posicionSecundaria);
										
										$('.modal-header').css("color","white");
										$('.modal-title').text("Editar a "+edit.firstName+" "+edit.lastName);
										$('#editarModal').modal("show");
									}
								});
							});

						});
	</script>
		<script type="text/javascript">
       w3IncludeHTML();
</script>
</body>
</html>