<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<!-- Bootstrap CSS -->
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
	integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
	crossorigin="anonymous">

<!--  Datatables  -->
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/v/bs4/dt-1.10.20/datatables.min.css" />

<!--  extension responsive  -->
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css">
<title>Listado de Jugadores</title>
<title>Jugadores</title>
</head>
<body class="bg-light">
	
	<script src="https://www.w3schools.com/lib/w3data.js"></script>
	
	<div class="">
	<div w3-include-html="navbar?id=listadoJugadores"></div>
	</div>

	<div class="container-fluid">
		<div class="row">
			<div class="py-3 text-center col-lg-12">
				<h1 class="font-weight-bold font-italic">LISTA JUGADORES</h1>
			</div>
		</div>


		<div class="row">
			<div class="col-lg-12 responsive">
				<table id="jugadores"
					class="table table-sm table-striped table-bordered table-hover nowrap"
					cellspacing="0" style="width: 100%;">
					<thead>
						<tr class="table-primary">
							<th>Nombre</th>
							<th>Apellido</th>
							<th>dni</th>
							<th>Direccion</th>
							<th>Email</th>
							<th>Localidad</th>
							<th>Altura</th>
							<th>Peso</th>
							<th>Fecha Nacimiento</th>
							<th>Posición</th>
							<th>Posicion Secundaria</th>
							<th>Acciones</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="jugador : ${jugadores}">
							<td th:text="${jugador.firstName}"></td>
							<td th:text="${jugador.lastName}"></td>
							<td th:text="${jugador.dni}"></td>
							<td th:text="${jugador.direccion}"></td>
							<td th:text="${jugador.email}"></td>
							<td th:text="${jugador.localidad}"></td>
							<td th:text="${jugador.altura}"></td>
							<td th:text="${jugador.peso}"></td>
							<td th:text="${jugador.fechaNacimiento}"></td>
							<td th:text="${jugador.posicionPrincipal}"></td>
							<td th:text="${jugador.posicionSecundaria}"></td>
							<td>
								<input type="hidden" id="id" th:value="${jugador.id}"></input>
									<button  class="btn btn-outline-success mx-0 estadisticas" type="button"><svg width="1.5em" height=1.5em viewBox="0 0 16 16" class="bi bi-graph-up" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
										<path fill-rule="evenodd" d="M0 0h1v15h15v1H0V0zm10 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V4.9l-3.613 4.417a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61L13.445 4H10.5a.5.5 0 0 1-.5-.5z"/>
										</svg>
										<title>Estadísticas</title>
									</button>
								<a style="text-decoration: none" href="#" th:href="@{/jugadores/jugadorform?id=__${jugador.id}__}">
									<button class="btn btn-outline-info mx-0" type="button"><svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-pencil-square" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
										<path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456l-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
										<path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
										</svg>
										<title>Editar</title>
									</button>
								</a>
								<a style="text-decoration: none" href="#" th:href="@{/jugadores/deletejugador?id=__${jugador.id}__}">
									<button class="btn btn-outline-danger mx-0" type="button"><svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-trash" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
										<path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
										<path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4L4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
										</svg>
										<title>Borrar</title>
									</button>
								</a>		
							</td>
					</tbody>

				</table>
			</div>
		</div>
	</div>

	<div class="row my-3">
		<div class="col-lg-2"></div>
		<div class="col-lg-8">
			<button onclick="location.href='/jugadores/jugadorform?id=0'"
				class="btn btn-primary btn-lg btn-block" type="submit">Añadir
				jugador</button>

		</div>
		<div class="col-lg-2"></div>
	</div>
	
	<!-- Modal -->
	<div class="modal fade" id="estadisticasModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog modal-xl modal-dialog-centered">
	    <div class="modal-content">
	      <div class="modal-header bg-success">
	        <h5 class="modal-title" id="staticBackdropLabel">Estadísticas</h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body">
	      <div id="contenedor-modal"></div>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
	      </div>
	    </div>
	  </div>
	</div>


	<script src=https://code.jquery.com/jquery-3.5.1.js></script>
	<!-- Optional JavaScript -->
	<script
		src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
		integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>

	<!--   Datatables-->
	<script type="text/javascript"
		src="https://cdn.datatables.net/v/bs4/dt-1.10.20/datatables.min.js"></script>

	<!-- extension responsive -->
	<script
		src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
	<script type="text/javascript"
        src="//code.highcharts.com/highcharts.js"></script>
		
	<!-- Highcharts JS               
    <script src="pluggins/Highcharts_7.0.3/code/highcharts.js"></script>
	<script src="pluggins/Highcharts_7.0.3/code/modules/exporting.js"></script>
    <script src="pluggins/Highcharts_7.0.3/code/modules/export-data.js"></script>  -->
	<script>
		$(document)
				.ready(
						function() {
							$('#jugadores')
									.DataTable(
											{
												responsive : true,
												columnDefs : [ {
													responsivePriority : 0,
													targets : 0
												}, {
													responsivePriority : 1,
													targets : -1
												}, {
													responsivePriority : 2,
													targets : 6
												}, {
													responsivePriority : 2,
													targets : 7
												}, {
													responsivePriority : 0,
													targets : 9
												} ],
												"language" : {
													"url" : "https:////cdn.datatables.net/plug-ins/1.10.21/i18n/Spanish.json"
												}
											});
							$('table .estadisticas').on('click', function(){
								var id = $(this).parent().find('#id').val();
																
								$.ajax({
									type: 'GET',
									url: '/jugadores/findjugador/'+id,
									success: function(stats){
										var max = Math.max(stats.saquesTotales,stats.recepcionesTotales,stats.colocacionesTotales,stats.defensasTotales,stats.bloqueosTotales,stats.rematesTotales,stats.fintasTotales,stats.numAtaquesRapidosTotales);

										Highcharts.chart('contenedor-modal', {
											chart: {
								                type: 'column',
								            },
								            xAxis: {
								                categories: [
								                    'Saque',
								                    'Recepción',
								                    'Colocación',
								                    'Defensa',
								                    'Bloqueo',
								                    'Remate',
								                    'Finta',
								                    'Ataque Rápido'
								                ],
								                crosshair: true
								            },
								            yAxis: {
								                min: 0,
								                title: {
								                    text: 'Valores'
								                }
								            },
								            tooltip: {
								                headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
								                pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
								                    '<td style="padding:0"><b>{point.y:f} </b></td></tr>',
								                footerFormat: '</table>',
								                shared: true,
								                useHTML: true
								            },
								            plotOptions: {
								                column: {
								                    pointPadding: 0.2,
								                    borderWidth: 0
								                }
								            },
								            series: [
								                {
								                    name: 'Acertados',
								                    data: [stats.saquesAcertados,stats.recepcionesAcertadas,stats.colocacionesAcertadas,stats.defensasAcertadas,stats.bloqueosAcertados,stats.rematesAcertados,stats.fintasAcertadas,stats.numAtaquesRapidosAcertados]
								                },
								                {
								                    name: 'Totales',
								                    data: [stats.saquesTotales,stats.recepcionesTotales,stats.colocacionesTotales,stats.defensasTotales,stats.bloqueosTotales,stats.rematesTotales,stats.fintasTotales,stats.numAtaquesRapidosTotales],
								                },
								                {
								                    name: 'Porcentajes',
								                    data: [stats.porcentajeSaques*max,stats.porcentajeRecepciones*max,stats.porcentajeColocaciones*max,stats.porcentajeDefensas*max,stats.porcentajeBloqueos*max,stats.porcentajeRemates*max,stats.porcentajeFintas*max,stats.porcentajeAtaquesRapidos*max],
								                }
								            ]
										})
									}
								});
								
								$('#estadisticasModal').modal("show");
							})

						});
	</script>
		<script type="text/javascript">
       w3IncludeHTML();
</script>
</body>
</html>