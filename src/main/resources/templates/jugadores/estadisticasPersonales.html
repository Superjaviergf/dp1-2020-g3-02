<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<!-- Bootstrap CSS -->
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
	integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
	crossorigin="anonymous">

<!--  Datatables  -->
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/v/bs4/dt-1.10.20/datatables.min.css" />

<!--  extension responsive  -->
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css">
<title>Listado de Jugadores</title>
<title>Jugadores</title>
</head>
<body class="bg-light">
	
	<script src="https://www.w3schools.com/lib/w3data.js"></script>
	
	<div class="">
	<div w3-include-html="navbar?id=estadisticasPartido"></div>
	</div>

	<div class="container-fluid">
		<div class="row">
			<div class="py-3 text-center col-lg-12">
				<h1 class="font-weight-bold font-italic">ESTADISITICAS JUGADOR</h1>
			</div>
		</div>

		<div class="row">
			<div class="col">
				<input type="hidden" id="id" th:value="saque">
				<button class="btn btn-outline-info btn-sm stats" type="button">SAQUES</button>
			</div>

			<div class="col">
				<input type="hidden" id="id" th:value="recepcion">
				<button class="btn btn-outline-info btn-sm stats" type="button">RECEPCIONES</button>
			</div>

			<div class="col">
				<input type="hidden" id="id" th:value="colocacion">
				<button class="btn btn-outline-info btn-sm stats" type="button">COLOCACIONES</button>
			</div>
			
			<div class="col">
				<input type="hidden" id="id" th:value="defensa">
				<button class="btn btn-outline-info btn-sm stats" type="button">DEFENSAS</button>
			</div>
		</div>

		<div class="row">
			<div class="col-lg-12 responsive">
				<table id="estadisiticas"
					class="table table-sm table-striped table-bordered table-hover nowrap"
					cellspacing="0" style="width: 100%;">
					<thead>
						<tr class="table-primary">
							
							<th>FECHA</th>
							<th>HORA</th>
							<th>S_A</th>
							<th>S_T</th>
							<th>%_S</th>
							<th>R_A</th>
							<th>R_T</th>
							<th>%_R</th>
							<th>C_A</th>
							<th>C_T</th>
							<th>%_C</th>
							<th>D_A</th>
							<th>D_T</th>
							<th>%_D</th>
							
						</tr>
					</thead>
					<tbody>
						<tr th:each="estadistica : ${estadisticas}">
							
							<td  th:text="${estadistica.Partido.fecha}"></td>
							<td  th:text="${estadistica.Partido.hora}"></td>
							<td th:text="${estadistica.saquesAcertados}"></td>
							<td th:text="${estadistica.saquesTotales}"></td>
							<td th:text="${estadistica.porcentajeSaques}"></td>
							<td th:text="${estadistica.recepcionesAcertadas}"></td>
							<td th:text="${estadistica.recepcionesTotales}"></td>
							<td th:text="${estadistica.PorcentajeRecepciones}"></td>
							<td th:text="${estadistica.colocacionesAcertadas}"></td>
							<td th:text="${estadistica.colocacionesTotales}"></td>
							<td th:text="${estadistica.PorcentajeColocaciones}"></td>
							<td th:text="${estadistica.defensasAcertadas}"></td>
							<td th:text="${estadistica.defensasTotales}"></td>
							<td th:text="${estadistica.PorcentajeDefensas}"></td>
		
						</tr>
					</tbody>

				</table>
			</div>
		</div>
		
	</div>



	<script src=https://code.jquery.com/jquery-3.5.1.js></script>
	<!-- Optional JavaScript -->
	<script
		src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
		integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>

	<!--   Datatables-->
		
	<script type="text/javascript"
		src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>

	<!-- extension responsive -->
	<script
		src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
		
	<script type="text/javascript"
		src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>
		
	<script type="text/javascript"
		src="//code.highcharts.com/highcharts.js"></script>
		
		
	<script type="text/javascript"
		src="https://cdn.datatables.net/v/bs4/dt-1.10.20/datatables.min.js"></script>
	
	<script
		src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
	
	
	<script type="text/javascript">
	/**
	 * 
	 */

	$(document).ready(function () {
		    // Create DataTable
		    var table = $('#estadisiticas').DataTable({
		        dom: '',
		        responsive: true,
		        
		    });
		    var chart = null;
		    $('.stats').on('click', function(){
				var tipo = $(this).parent().find('#id').val(); 
				
		 	if(chart != null){
		 		chart.destroy();
		 	}
		    // Create the chart with initial data
		    var container = $('<div/>').insertBefore(table.table().container());
		 
		     chart = Highcharts.chart(container[0], {
		        chart: {
		            type: 'column',
		        },
		        title: {
		            text: name(table,tipo),
		        },
		        xAxis: {
		            categories: fechas(table),
		            crosshair: true
		        },
		        yAxis: [{ // Primary yAxis
		            labels: {
		                format: '{value}',
		                style: {
		                    color: Highcharts.getOptions().colors[1]
		                }
		            },
		            title: {
		                text: 'Estad√≠sticas',
		                style: {
		                    color: Highcharts.getOptions().colors[1]
		                }
		            },
		            opposite: true
		        }, { // Secondary yAxis
		        	max: 100,
		        	min: 0,
		            title: {
		                text: 'Porcentaje',
		                style: {
		                    color: Highcharts.getOptions().colors[0]
		                }
		            },
		            labels: {
		                format: '{value} %',
		                style: {
		                    color: Highcharts.getOptions().colors[1]
		                }
		            }
		        }],
		        tooltip: {
		            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
		            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
		                '<td style="padding:0"><b>{point.y:f}</b></td></tr>',
		            footerFormat: '</table>',
		            shared: true,
		            useHTML: true
		        },
		        plotOptions: {
		            column: {
		                pointPadding: 0.2,
		                borderWidth: 0
		            }
		        },
		        series: [
		            {	            	
		            	name: name1(table,tipo),
		            	data: chartData(table,tipo),
		            	yAxis: 0
		            	
		            },
		            {
		            	name: name2(table,tipo),
		            	data: chartData2(table,tipo),
		            	yAxis: 0
		            }, 
		            {
		                type: 'spline',
		                name: 'Porcentaje',
		                data: chartData3(table,tipo),
		                yAxis: 1,
		                tooltip: {
		                    valueSuffix: ' %'
		                },
		                marker: {
		                    lineWidth: 2,
		                    lineColor: Highcharts.getOptions().colors[3],
		                    fillColor: 'white'
		                }
		            }
		        ],
		    });
		    
		    table.on('draw', function () {
		        chart.series[0].setData(chartData(table));
		    });
		    });
		});
	
	
	
 // FUNCTIONS	
	

			function name1(table,tipo){
				
				if(tipo == 'saque'){
					return 'Saques Acertados';
				}else if (tipo == 'recepcion'){
					return 'Recepciones Acertadas';
				}else if(tipo == 'colocacion'){
					return 'Colocaciones Acertadas'
				}else if (tipo == 'defensa'){
					return 'Defensas Acertadas'
				}
			}
			
			function name2(table,tipo){
				
				
				if(tipo == 'saque'){
					return 'Saques Totales';
				}else if (tipo == 'recepcion'){
					return 'Recepciones Totales';
				} else if(tipo == 'colocacion'){
					return 'Colocaciones Totales'
				}else if (tipo == 'defensa'){
					return 'Defensas Totales'
				}
			}
			
			function name(table,tipo){
				
				
				if(tipo == 'saque'){
					return 'SAQUES';
				}else if (tipo == 'recepcion'){
					return 'RECEPCIONES';
				}else if(tipo == 'colocacion'){
					return 'COLOCACIONES'
				}else if (tipo == 'defensa'){
					return 'DEFENSAS'
				}
			}
			
		    function chartData(table,tipo) {
		        var counts = {};
		     	var fechas = [];
		     	var horas = [];
		     	var dato = [];
		        
		     	var columna = 0;
		     	
		     	if (tipo == 'saque'){
		     		columna = 2;
		     	} else if(tipo == 'recepcion'){
		     		columna = 5;
		     	}else if (tipo == 'colocacion'){
		     		columna = 8;
		     	}else if (tipo == 'defensa'){
					columna = 11;
				}
		        // Count the number of entries for each position
		        table
		            .column(0, { search: 'applied' })
		            .data()
		            .each(function (val) {
		            	fechas.push( val);
		            });
		        
		        table
	            .column(1, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	horas.push( val);
	            });
		        
		        table
	            .column(columna, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	dato.push( parseInt(val,10));
	            });
		        
		         
		        
		        for (i = 0; i < fechas.length; i++){
		        	counts[fechas[i]+" "+horas[i]] = dato[i];
		        }
		        
		     
		        // And map it to the format highcharts uses
		        return $.map(counts, function (val, key) {
		            return {
		                name: key,
		                y: val,
		            };
		        });
		    }
		    
		    function chartData2(table,tipo) {
		        var counts = {};
		     	var fechas = [];
		     	var horas = [];
		     	var dato = [];
		        
				var columna = 0;
		     	
		     	if (tipo == 'saque'){
		     		columna = 3;
		     	} else if(tipo == 'recepcion'){
		     		columna = 6;
		     	} else if (tipo == 'colocacion'){
		     		columna = 9;
		     	}else if (tipo == 'defensa'){
					columna = 12;
		     	}					
		        // Count the number of entries for each position
		        table
		            .column(0, { search: 'applied' })
		            .data()
		            .each(function (val) {
		            	fechas.push(val);
		            });
		        
		        table
	            .column(1, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	horas.push( val);
	            });
		        
		        table
	            .column(columna, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	dato.push( parseInt(val,10));
	            });
		        
		        for (i = 0; i < fechas.length; i++){
		        	counts[fechas[i]+" "+horas[i]] = dato[i];
		        }
		        
		     
		        // And map it to the format highcharts uses
		        return $.map(counts, function (val, key) {
		            return {
		                name: key,
		                y: val,
		            };
		        });
		        
		        
		    }
		     
		    function chartData3(table,tipo) {
		        var counts = {};
		     	var fechas = [];
		     	var horas = [];
		     	var dato = [];
		     	
				var columna = 0;
		     	
		     	if (tipo == 'saque'){
		     		columna = 4;
		     	} else if(tipo == 'recepcion'){
		     		columna = 7;
		     	}else if(tipo == 'colocacion'){
		     		columna = 10;
		     	}else if (tipo == 'defensa'){
					columna = 13;
		     	}
		        
		        // Count the number of entries for each position
		        table
		            .column(0, { search: 'applied' })
		            .data()
		            .each(function (val) {
		            	fechas.push( val);
		            });
		        
		        table
	            .column(1, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	horas.push( val);
	            });
		        
		        table
	            .column(columna, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	dato.push( parseFloat(val));
	            });
		        
		        for (i = 0; i < fechas.length; i++){
		        	counts[fechas[i]+" "+horas[i]] = dato[i]*100;
		        }
		        
		       
		     
		        // And map it to the format highcharts uses
		        return $.map(counts, function (val, key) {
		            return {
		                name: key,
		                y: val,
		            };
		        });
		        
		        
		    }
			
		    function fechas(table) {
		        
		     	var fecha = [];
		        
		        // Count the number of entries for each position
		        table
		            .column(0, { search: 'applied' })
		            .data()
		            .each(function (val) {
		            	fecha.push( val);
		            });
		        
		        // And map it to the format highcharts uses
		        return fecha;
		        
		      
		        
		        
		    }
		    
	
	</script>
	
	<script type="text/javascript">
       w3IncludeHTML();
	</script>
</body>
</html>